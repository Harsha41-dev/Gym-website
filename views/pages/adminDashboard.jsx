const React = require("react");
const ejs = require("ejs");
const MainLayout = require("../layouts/MainLayout");
const fallbackData = require("../utils/fallbackData");

const template = "<main>\n  <div class=\"container my-5\">\n    <div class=\"dashboard-welcome\">\n      <h2 class=\"mb-4\">\n        <i class=\"fas fa-chart-line me-2\"></i>Hello, <%= locals.userName %>!\n      </h2>\n      <p class=\"lead mb-4\">Welcome to the admin dashboard. Monitor and manage your gym operations from here.</p>\n    </div>\n    <div class=\"row mb-4\">\n      <div class=\"col-lg-8\">\n        <p class=\"lead text-white\">Manage your gym facility, users, and system settings.</p>\n      </div>\n    </div>\n    \n    <div class=\"row g-4\">\n      <!-- Quick Stats -->\n      <div class=\"col-12 mb-4\">\n        <div class=\"dashboard-panel\">\n          <h4 class=\"text-danger mb-4\"><i class=\"fas fa-chart-line me-2\"></i>Overview</h4>\n          <div class=\"row text-center\">\n            <div class=\"col-md-3 mb-3\">\n              <a href=\"/admin/users\" class=\"text-decoration-none\">\n                <div class=\"stat-card-improved\">\n                  <div class=\"stat-icon\">\n                    <i class=\"fas fa-users text-primary\"></i>\n                  </div>\n                  <div class=\"stat-info\">\n                    <div class=\"stat-value\"><%= locals.stats?.userCount || 0 %></div>\n                    <div class=\"stat-label\">Members</div>\n                  </div>\n                </div>\n              </a>\n            </div>\n            <div class=\"col-md-3 mb-3\">\n              <a href=\"/admin/trainers\" class=\"text-decoration-none\">\n                <div class=\"stat-card-improved\">\n                  <div class=\"stat-icon\">\n                    <i class=\"fas fa-user-tie text-warning\"></i>\n                  </div>\n                  <div class=\"stat-info\">\n                    <div class=\"stat-value\"><%= locals.stats?.trainerCount || 0 %></div>\n                    <div class=\"stat-label\">Trainers</div>\n                    <% if (locals.stats?.pendingTrainerCount > 0) { %>\n                      <span class=\"position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger\">\n                        <%= locals.stats.pendingTrainerCount %>\n                        <span class=\"visually-hidden\">pending trainers</span>\n                      </span>\n                    <% } %>\n                  </div>\n                </div>\n              </a>\n            </div>\n            <div class=\"col-md-3 mb-3\">\n              <div class=\"stat-card-improved\">\n                <div class=\"stat-icon\">\n                  <i class=\"fas fa-calendar-check text-success\"></i>\n                </div>\n                <div class=\"stat-info\">\n                  <div class=\"stat-value\"><%= locals.stats?.bookingCount || 0 %></div>\n                  <div class=\"stat-label\">Sessions</div>\n                </div>\n              </div>\n            </div>\n            <div class=\"col-md-3 mb-3\">\n              <div class=\"stat-card-improved\">\n                <div class=\"stat-icon\">\n                  <i class=\"fas fa-clipboard-list text-info\"></i>\n                </div>\n                <div class=\"stat-info\">\n                  <div class=\"stat-value\"><%= locals.stats?.planCount || 0 %></div>\n                  <div class=\"stat-label\">Plans</div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      \n      <!-- Recent Registrations -->\n      <div class=\"dashboard-section mb-4\">\n        <div class=\"section-header mb-3\">\n          <h3><i class=\"fas fa-user-plus me-2\"></i>Recent Registrations</h3>\n        </div>\n        \n        <div class=\"table-responsive\">\n          <table class=\"table table-dark table-hover align-middle\">\n            <thead>\n              <tr>\n                <th>Name</th>\n                <th>Email</th>\n                <th>Role</th>\n                <th>Registered</th>\n                <th>Status</th>\n                <th>Actions</th>\n              </tr>\n            </thead>\n            <tbody>\n              <% if (locals.recentUsers && locals.recentUsers.length > 0) { %>\n                <% locals.recentUsers.forEach(user => { %>\n                  <tr>\n                    <td><%= user.name %></td>\n                    <td><%= user.email %></td>\n                    <td>\n                      <span class=\"badge <%= user.role === 'trainer' ? 'bg-warning text-dark' : 'bg-info' %>\">\n                        <%= user.role === 'admin' ? 'Admin' : user.role === 'trainer' ? 'Trainer' : 'Member' %>\n                      </span>\n                    </td>\n                    <td><%= new Date(user.createdAt).toLocaleDateString() %></td>\n                    <td>\n                      <% if (user.status === 'active') { %>\n                        <span class=\"badge bg-success\">Active</span>\n                      <% } else if (user.status === 'pending') { %>\n                        <span class=\"badge bg-warning text-dark\">Pending</span>\n                      <% } else { %>\n                        <span class=\"badge bg-secondary\">Inactive</span>\n                      <% } %>\n                    </td>\n                    <td>\n                      <div class=\"btn-group btn-group-sm\">\n                        <% if (user.role === 'trainer' && user.status === 'pending') { %>\n                          <a href=\"/admin/trainers/approve/<%= user._id %>\" class=\"btn btn-success\" title=\"Approve\">\n                            <i class=\"fas fa-check\"></i>\n                          </a>\n                          <a href=\"/admin/trainers/reject/<%= user._id %>\" class=\"btn btn-danger\" title=\"Reject\">\n                            <i class=\"fas fa-times\"></i>\n                          </a>\n                        <% } %>\n                        <a href=\"<%= user.role === 'trainer' ? '/admin/trainers' : '/admin/users' %>\" class=\"btn btn-info\" title=\"View All\">\n                          <i class=\"fas fa-eye\"></i>\n                        </a>\n                      </div>\n                    </td>\n                  </tr>\n                <% }); %>\n              <% } else { %>\n                <tr>\n                  <td colspan=\"6\" class=\"text-center\">No recent registrations found</td>\n                </tr>\n              <% } %>\n            </tbody>\n          </table>\n        </div>\n      </div>\n      \n      <!-- Activity Log -->\n      <div class=\"col-lg-6\">\n        <div class=\"dashboard-panel\">\n          <h4 class=\"text-danger mb-4\"><i class=\"fas fa-history me-2\"></i>Recent Activity</h4>\n          <div class=\"activity-log\">\n            <div class=\"activity-item bg-dark\">\n              <div class=\"activity-icon\">\n                <i class=\"fas fa-calendar-check text-success\"></i>\n              </div>\n              <div class=\"activity-details\">\n                <p class=\"mb-0 text-white\">\n                  Yash Malve booked a session with Tanish Garg\n                </p>\n                <small class=\"text-secondary\">\n                  05/03/2025 at 10:30 AM\n                </small>\n              </div>\n            </div>\n            <div class=\"activity-item bg-dark\">\n              <div class=\"activity-icon\">\n                <i class=\"fas fa-dumbbell text-warning\"></i>\n              </div>\n              <div class=\"activity-details\">\n                <p class=\"mb-0 text-white\">\n                  Vamsi Krishna completed Yoga Program\n                </p>\n                <small class=\"text-secondary\">\n                  04/03/2025 at 2:15 PM\n                </small>\n              </div>\n            </div>\n            <div class=\"activity-item bg-dark\">\n              <div class=\"activity-icon\">\n                <i class=\"fas fa-user-plus text-info\"></i>\n              </div>\n              <div class=\"activity-details\">\n                <p class=\"mb-0 text-white\">\n                  Deva Harshini registered as a new member\n                </p>\n                <small class=\"text-secondary\">\n                  28/02/2025 at 9:45 AM\n                </small>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      \n      <!-- Revenue Section -->\n      <div class=\"col-12\">\n        <div class=\"dashboard-panel\">\n          <h4 class=\"text-danger mb-4\"><i class=\"fas fa-dollar-sign me-2\"></i>Revenue</h4>\n          <div class=\"row\">\n            <div class=\"col-md-6\">\n              <div style=\"height: 300px; position: relative;\">\n                <canvas id=\"revenueChart\"></canvas>\n              </div>\n            </div>\n            <div class=\"col-md-6\">\n              <ul class=\"list-group\">\n                <li class=\"list-group-item d-flex justify-content-between align-items-center\">\n                  Strength Training Classes\n                  <span class=\"badge bg-success\">â‚¹44000</span>\n                </li>\n                <li class=\"list-group-item d-flex justify-content-between align-items-center\">\n                  Zumba\n                  <span class=\"badge bg-warning\">â‚¹30000</span>\n                </li>\n                <li class=\"list-group-item d-flex justify-content-between align-items-center\">\n                  Yoga Classes\n                  <span class=\"badge bg-danger\">â‚¹18000</span>\n                </li>\n              </ul>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</main>\n\n\n\n\n<style>\n  /* Additional styles for admin dashboard */\n  .stat-card-improved {\n    background-color: #414141;\n    border-radius: 10px;\n    padding: 1.5rem;\n    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);\n    transition: all 0.3s ease;\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    height: 100%;\n  }\n  \n  .stat-card-improved:hover {\n    transform: translateY(-5px);\n    box-shadow: 0 10px 25px rgba(229, 9, 20, 0.3);\n    background-color: #8f9052;\n  }\n  \n  .stat-icon {\n    font-size: 2.5rem;\n    margin-right: 1rem;\n  }\n  \n  .stat-info {\n    text-align: left;\n  }\n  \n  .stat-value {\n    font-size: 2rem;\n    font-weight: 700;\n    color: var(--primary-color);\n    line-height: 1;\n  }\n  \n  .stat-label {\n    font-size: 1rem;\n    color: var(--light-text);\n    opacity: 0.8;\n  }\n  \n  .user-icon, .activity-icon {\n    font-size: 1.75rem;\n    margin-right: 1rem;\n  }\n  \n  .registration-card {\n    background-color: #2a2a2a;\n    border-radius: 10px;\n    padding: 1rem;\n    transition: all 0.3s ease;\n    height: 100%;\n    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);\n  }\n  \n  .registration-card:hover {\n    transform: translateY(-3px);\n    box-shadow: 0 8px 20px rgba(229, 9, 20, 0.2);\n    background-color: #333;\n  }\n  \n  .text-primary {\n    color: #007bff !important;\n  }\n  \n  .text-success {\n    color: #28a745 !important;\n  }\n  \n  .text-warning {\n    color: #ffc107 !important;\n  }\n  \n  .text-info {\n    color: #17a2b8 !important;\n  }\n</style>";
const inlineScripts = ["document.addEventListener('DOMContentLoaded', function() {\n    const ctx = document.getElementById('revenueChart').getContext('2d');\n    const revenueChart = new Chart(ctx, {\n      type: 'pie',\n      data: {\n        labels: ['Strength Training Classes', 'Zumba Classes','Yoga Classes'],\n        datasets: [{\n          data: [44000, 30000, 18000],\n          backgroundColor: ['#28a745', '#ffc107', '#dc3545'],\n          borderColor: ['#212121', '#212121', '#212121'],\n          borderWidth: 1\n        }]\n      },\n      options: {\n        responsive: true,\n        maintainAspectRatio: false,\n        plugins: {\n          legend: {\n            position: 'top',\n            labels: {\n              color: '#f5f5f5',\n              font: {\n                family: \"'Poppins', sans-serif\",\n                size: 12\n              },\n              padding: 20\n            }\n          }\n        }\n      }\n    });\n  });"];
const externalScripts = ["https://cdn.jsdelivr.net/npm/chart.js"];

function AdminDashboard(props) {
  const defaults = (fallbackData && fallbackData["adminDashboard"]) || {};
  const data = { ...defaults, ...props };

  const defaultLocals = defaults.locals || {};
  const overrideLocals = props && props.locals ? props.locals : {};
  const locals = {
    ...defaultLocals,
    ...overrideLocals,
    isLoggedIn: data.isLoggedIn ?? defaultLocals.isLoggedIn ?? false,
    userRole: data.userRole ?? defaultLocals.userRole ?? "guest",
    userName: data.userName ?? defaultLocals.userName ?? "Guest",
  };

  data.locals = locals;

  let html = ejs.render(template, data);

  const collectedInlineScripts = [...inlineScripts];
  html = html.replace(/<script[^>]*>([\s\S]*?)<\/script>/gi, (_, body) => {
    const trimmed = body.trim();
    if (trimmed.length) {
      collectedInlineScripts.push(trimmed);
    }
    return "";
  });

  return (
    <MainLayout {...data} scripts={externalScripts}>
      <div dangerouslySetInnerHTML={{ __html: html }} />
      {collectedInlineScripts.map((script, index) => (
        <script key={index} dangerouslySetInnerHTML={{ __html: script }} />
      ))}
    </MainLayout>
  );
}

module.exports = AdminDashboard;




