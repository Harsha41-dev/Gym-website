const React = require("react");
const ejs = require("ejs");
const MainLayout = require("../layouts/MainLayout");
const fallbackData = require("../utils/fallbackData");

const template = "<main>\n  <div class=\"container my-5\">\n    <div class=\"row\">\n      <div class=\"col-lg-10 mx-auto\">\n        <div class=\"card\">\n          <div class=\"card-header bg-danger text-white\">\n            <h2 class=\"mb-0\"><i class=\"fas fa-calendar-check me-2\"></i>My Bookings</h2>\n          </div>\n          <div class=\"card-body\">\n            <!-- Nav tabs -->\n            <ul class=\"nav nav-tabs\" id=\"bookingTabs\" role=\"tablist\">\n              <li class=\"nav-item\">\n                <a class=\"nav-link active\" id=\"pending-tab\" data-bs-toggle=\"tab\" href=\"#pending\" role=\"tab\">\n                  <i class=\"fas fa-hourglass-half me-1\"></i>Pending\n                  <% if (pendingBookings && pendingBookings.length > 0) { %>\n                    <span class=\"badge bg-secondary ms-1\"><%= pendingBookings.length %></span>\n                  <% } %>\n                </a>\n              </li>\n              <li class=\"nav-item\">\n                <a class=\"nav-link\" id=\"upcoming-tab\" data-bs-toggle=\"tab\" href=\"#upcoming\" role=\"tab\">\n                  <i class=\"fas fa-calendar me-1\"></i>Upcoming\n                  <% if (upcomingBookings && upcomingBookings.length > 0) { %>\n                    <span class=\"badge bg-secondary ms-1\"><%= upcomingBookings.length %></span>\n                  <% } %>\n                </a>\n              </li>\n              <li class=\"nav-item\">\n                <a class=\"nav-link\" id=\"past-tab\" data-bs-toggle=\"tab\" href=\"#past\" role=\"tab\">\n                  <i class=\"fas fa-history me-1\"></i>Past\n                  <% if (pastBookings && pastBookings.length > 0) { %>\n                    <span class=\"badge bg-secondary ms-1\"><%= pastBookings.length %></span>\n                  <% } %>\n                </a>\n              </li>\n            </ul>\n\n            <!-- Tab content -->\n            <div class=\"tab-content mt-4\">\n              <!-- Pending Bookings -->\n              <div class=\"tab-pane fade show active\" id=\"pending\" role=\"tabpanel\">\n                <% if (pendingBookings && pendingBookings.length > 0) { %>\n                  <div class=\"table-responsive\">\n                    <table class=\"table table-hover\">\n                      <thead class=\"table-light\">\n                        <tr>\n                          <th>Client</th>\n                          <th>Plan</th>\n                          <th>Date & Time</th>\n                          <th>Status</th>\n                          <th>Actions</th>\n                        </tr>\n                      </thead>\n                      <tbody>\n                        <% pendingBookings.forEach(booking => { %>\n                          <tr>\n                            <td>\n                              <div class=\"d-flex align-items-center\">\n                                <% if (booking.user.profilePicture) { %>\n                                  <img src=\"<%= booking.user.profilePicture %>\" class=\"rounded-circle me-2\" width=\"40\" height=\"40\">\n                                <% } else { %>\n                                  <div class=\"bg-secondary rounded-circle d-flex align-items-center justify-content-center me-2\" style=\"width: 40px; height: 40px;\">\n                                    <i class=\"fas fa-user text-white\"></i>\n                                  </div>\n                                <% } %>\n                                <div><%= booking.user.name %></div>\n                              </div>\n                            </td>\n                            <td><%= booking.planTitle %></td>\n                            <td>\n                              <%= new Date(booking.startTime).toLocaleDateString() %><br>\n                              <small class=\"text-muted\"><%= new Date(booking.startTime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) %></small>\n                            </td>\n                            <td><span class=\"badge bg-warning\">Pending</span></td>\n                            <td>\n                              <div class=\"btn-group\">\n                                <a href=\"/bookings/<%= booking._id %>\" class=\"btn btn-sm btn-outline-primary\">\n                                  <i class=\"fas fa-eye\"></i>\n                                </a>\n                                <a href=\"/trainer/bookings/confirm/<%= booking._id %>\" class=\"btn btn-sm btn-success\">\n                                  <i class=\"fas fa-check\"></i>\n                                </a>\n                                <a href=\"/trainer/bookings/cancel/<%= booking._id %>\" class=\"btn btn-sm btn-danger\">\n                                  <i class=\"fas fa-times\"></i>\n                                </a>\n                              </div>\n                            </td>\n                          </tr>\n                        <% }); %>\n                      </tbody>\n                    </table>\n                  </div>\n                <% } else { %>\n                  <div class=\"alert alert-info\">\n                    <i class=\"fas fa-info-circle me-2\"></i>No pending bookings.\n                  </div>\n                <% } %>\n              </div>\n\n              <!-- Upcoming Bookings -->\n              <div class=\"tab-pane fade\" id=\"upcoming\" role=\"tabpanel\">\n                <% if (upcomingBookings && upcomingBookings.length > 0) { %>\n                  <div class=\"table-responsive\">\n                    <table class=\"table table-hover\">\n                      <thead class=\"table-light\">\n                        <tr>\n                          <th>Client</th>\n                          <th>Plan</th>\n                          <th>Date & Time</th>\n                          <th>Status</th>\n                          <th>Actions</th>\n                        </tr>\n                      </thead>\n                      <tbody>\n                        <% upcomingBookings.forEach(booking => { %>\n                          <tr>\n                            <td>\n                              <div class=\"d-flex align-items-center\">\n                                <% if (booking.user.profilePicture) { %>\n                                  <img src=\"<%= booking.user.profilePicture %>\" class=\"rounded-circle me-2\" width=\"40\" height=\"40\">\n                                <% } else { %>\n                                  <div class=\"bg-secondary rounded-circle d-flex align-items-center justify-content-center me-2\" style=\"width: 40px; height: 40px;\">\n                                    <i class=\"fas fa-user text-white\"></i>\n                                  </div>\n                                <% } %>\n                                <div><%= booking.user.name %></div>\n                              </div>\n                            </td>\n                            <td><%= booking.planTitle %></td>\n                            <td>\n                              <%= new Date(booking.startTime).toLocaleDateString() %><br>\n                              <small class=\"text-muted\"><%= new Date(booking.startTime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) %></small>\n                            </td>\n                            <td><span class=\"badge bg-success\">Confirmed</span></td>\n                            <td>\n                              <div class=\"btn-group\">\n                                <a href=\"/bookings/<%= booking._id %>\" class=\"btn btn-sm btn-outline-primary\">\n                                  <i class=\"fas fa-eye\"></i>\n                                </a>\n                                <a href=\"/trainer/bookings/complete/<%= booking._id %>\" class=\"btn btn-sm btn-outline-success\">\n                                  <i class=\"fas fa-check-double\"></i>\n                                </a>\n                              </div>\n                            </td>\n                          </tr>\n                        <% }); %>\n                      </tbody>\n                    </table>\n                  </div>\n                <% } else { %>\n                  <div class=\"alert alert-info\">\n                    <i class=\"fas fa-info-circle me-2\"></i>No upcoming bookings.\n                  </div>\n                <% } %>\n              </div>\n\n              <!-- Past Bookings -->\n              <div class=\"tab-pane fade\" id=\"past\" role=\"tabpanel\">\n                <% if (pastBookings && pastBookings.length > 0) { %>\n                  <div class=\"table-responsive\">\n                    <table class=\"table table-hover\">\n                      <thead class=\"table-light\">\n                        <tr>\n                          <th>Client</th>\n                          <th>Plan</th>\n                          <th>Date & Time</th>\n                          <th>Status</th>\n                          <th>Actions</th>\n                        </tr>\n                      </thead>\n                      <tbody>\n                        <% pastBookings.forEach(booking => { %>\n                          <tr>\n                            <td>\n                              <div class=\"d-flex align-items-center\">\n                                <% if (booking.user.profilePicture) { %>\n                                  <img src=\"<%= booking.user.profilePicture %>\" class=\"rounded-circle me-2\" width=\"40\" height=\"40\">\n                                <% } else { %>\n                                  <div class=\"bg-secondary rounded-circle d-flex align-items-center justify-content-center me-2\" style=\"width: 40px; height: 40px;\">\n                                    <i class=\"fas fa-user text-white\"></i>\n                                  </div>\n                                <% } %>\n                                <div><%= booking.user.name %></div>\n                              </div>\n                            </td>\n                            <td><%= booking.planTitle %></td>\n                            <td>\n                              <%= new Date(booking.startTime).toLocaleDateString() %><br>\n                              <small class=\"text-muted\"><%= new Date(booking.startTime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) %></small>\n                            </td>\n                            <td>\n                              <% if (booking.status === 'cancelled') { %>\n                                <span class=\"badge bg-danger\">Cancelled</span>\n                              <% } else if (booking.status === 'completed') { %>\n                                <span class=\"badge bg-secondary\">Completed</span>\n                              <% } %>\n                            </td>\n                            <td>\n                              <a href=\"/bookings/<%= booking._id %>\" class=\"btn btn-sm btn-outline-primary\">\n                                <i class=\"fas fa-eye\"></i>\n                              </a>\n                            </td>\n                          </tr>\n                        <% }); %>\n                      </tbody>\n                    </table>\n                  </div>\n                <% } else { %>\n                  <div class=\"alert alert-info\">\n                    <i class=\"fas fa-info-circle me-2\"></i>No past bookings.\n                  </div>\n                <% } %>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</main>";
const inlineScripts = ["document.addEventListener('DOMContentLoaded', function() {\n    // Handle tab navigation\n    const triggerTabList = [].slice.call(document.querySelectorAll('#bookingTabs a'));\n    triggerTabList.forEach(function(triggerEl) {\n      const tabTrigger = new bootstrap.Tab(triggerEl);\n      triggerEl.addEventListener('click', function(event) {\n        event.preventDefault();\n        tabTrigger.show();\n      });\n    });\n  });"];
const externalScripts = [];

function TrainerBookings(props) {
  const defaults = (fallbackData && fallbackData["trainer-bookings"]) || {};
  const data = { ...defaults, ...props };

  const defaultLocals = defaults.locals || {};
  const overrideLocals = props && props.locals ? props.locals : {};
  const locals = {
    ...defaultLocals,
    ...overrideLocals,
    isLoggedIn: data.isLoggedIn ?? defaultLocals.isLoggedIn ?? false,
    userRole: data.userRole ?? defaultLocals.userRole ?? "guest",
    userName: data.userName ?? defaultLocals.userName ?? "Guest",
  };

  data.locals = locals;

  let html = ejs.render(template, data);

  const collectedInlineScripts = [...inlineScripts];
  html = html.replace(/<script[^>]*>([\s\S]*?)<\/script>/gi, (_, body) => {
    const trimmed = body.trim();
    if (trimmed.length) {
      collectedInlineScripts.push(trimmed);
    }
    return "";
  });

  return (
    <MainLayout {...data} scripts={externalScripts}>
      <div dangerouslySetInnerHTML={{ __html: html }} />
      {collectedInlineScripts.map((script, index) => (
        <script key={index} dangerouslySetInnerHTML={{ __html: script }} />
      ))}
    </MainLayout>
  );
}

module.exports = TrainerBookings;




